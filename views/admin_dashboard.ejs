<!DOCTYPE html>
<html lang="bg">
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta charset="UTF-8">
  <title>๐ Admin Panel</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header>
    <h1>๐ ADMIN DASHBOARD</h1>
    <p>๐ค ะะพััะตะฑะธัะตะปะธ: <%= userStats.total_users %> | ๐ฆ ะะพัััะบะธ: <%= stats.total_orders %> | ๐ฐ ะัะธัะพะดะธ: $<%= stats.total_revenue.toFixed(2) %></p>
  </header>

  <section>
    <h2>๐ฆ ะัะพะดัะบัะธ</h2>
    <table>
      <tr><th>ะะผะต</th><th>ะฆะตะฝะฐ</th><th>ะะฐะปะธัะฝะพัั</th><th>ะะฐัะตะณะพัะธั</th><th>ะะตะนััะฒะธั</th></tr>
      <% products.forEach(p => { %>
        <tr>
          <td><%= p.name %></td>
          <td>ะปะฒ.<%= p.price.toFixed(2) %></td>
          <td><%= p.stock %></td>
          <td><%= p.category %></td>
          <td>
  <form method="POST" action="/admin/product/update/<%= p.id %>">
<input type="text" name="name" value="<%= p.name %>" required />
              <input type="number" name="price" value="<%= p.price %>" step="0.01" required />
              <input type="number" name="stock" value="<%= p.stock %>" required />
              <input type="text" name="category" value="<%= p.category %>" />
              <button type="submit">๐พ ะะฐะฟะฐะทะธ</button>
  </form>
  <form method="POST" action="/admin/product/delete/<%= p.id %>">onsubmit="return confirm('ะกะธะณััะตะฝ ะปะธ ัะธ?')">
    <button class="btn danger">๐๏ธ ะะทััะธะน</button>
  </form>
          </td>
        </tr>
      <% }) %>
    </table>

    <h3>โ ะะพะฑะฐะฒะธ ะฝะพะฒ ะฟัะพะดัะบั</h3>
    <form method="POST" action="/admin/product/create">
      <input type="text" name="name" placeholder="ะะผะต" required />
      <input type="text" name="description" placeholder="ะะฟะธัะฐะฝะธะต" />
      <input type="number" name="price" placeholder="ะฆะตะฝะฐ" step="0.01" required />
      <input type="number" name="stock" placeholder="ะะฐะปะธัะฝะพัั" required />
      <input type="text" name="category" placeholder="ะะฐัะตะณะพัะธั" />
      <input type="text" name="image" placeholder="URL ะฝะฐ ะธะทะพะฑัะฐะถะตะฝะธะต" />
      <label><input type="checkbox" name="featured" /> Featured</label>
      <button type="submit">โ ะกัะทะดะฐะน</button>
    </form>
  </section>

  <section>
    <h2>๐ ะะพัะปะตะดะฝะธ ะฟะพัััะบะธ</h2>
    <table>
      <tr><th>ID</th><th>ะะพััะตะฑะธัะตะป</th><th>ะัะพะดัะบั</th><th>ะกัะผะฐ</th><th>ะกัะฐััั</th><th>ะะฐัะฐ</th></tr>
      <% orders.forEach(o => { %>
        <tr>
          <td><%= o.id %></td>
          <td><%= o.username %></td>
          <td><%= o.product_name %></td>
          <td>$<%= o.total_amount.toFixed(2) %></td>
          <td><%= o.payment_status %></td>
          <td><%= o.created_at %></td>
        </tr>
      <% }) %>
    </table>
  </section>
<section>
  <h2>๐ ะกัะฐัะธััะธะบะฐ</h2>
  <div style="width: 100%; max-width: 800px;">
    <canvas id="ordersChart"></canvas>
    <canvas id="revenueChart" style="margin-top: 2rem;"></canvas>
  </div>
</section>
<script>
  const ordersData = <%- JSON.stringify(chartData.ordersByDay) %>;
  const revenueData = <%- JSON.stringify(chartData.revenueByDay) %>;

  const ordersCtx = document.getElementById('ordersChart').getContext('2d');
  new Chart(ordersCtx, {
    type: 'bar',
    data: {
      labels: ordersData.map(d => d.date),
      datasets: [{
        label: '๐ฆ ะะพัััะบะธ',
        data: ordersData.map(d => d.count),
        backgroundColor: '#00ff00'
      }]
    }
  });

  const revenueCtx = document.getElementById('revenueChart').getContext('2d');
  new Chart(revenueCtx, {
    type: 'line',
    data: {
      labels: revenueData.map(d => d.date),
      datasets: [{
        label: '๐ฐ ะัะธัะพะดะธ (ะปะฒ)',
        data: revenueData.map(d => d.total),
        borderColor: '#ff0000',
        fill: false
      }]
    }
  });
</script>
</body>
</html>
