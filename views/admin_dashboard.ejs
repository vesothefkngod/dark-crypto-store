<!DOCTYPE html>
<html lang="bg">
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta charset="UTF-8">
  <title>üíÄ Admin Panel</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header>
    <h1>üíÄ ADMIN DASHBOARD</h1>
    <p>üë§ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏: <%= userStats.total_users %> | üì¶ –ü–æ—Ä—ä—á–∫–∏: <%= stats.total_orders %> | üí∞ –ü—Ä–∏—Ö–æ–¥–∏: $<%= stats.total_revenue.toFixed(2) %></p>
  </header>

  <section>
    <h2>üì¶ –ü—Ä–æ–¥—É–∫—Ç–∏</h2>
    <table>
      <tr><th>–ò–º–µ</th><th>–¶–µ–Ω–∞</th><th>–ù–∞–ª–∏—á–Ω–æ—Å—Ç</th><th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
      <% products.forEach(p => { %>
        <tr>
          <td><%= p.name %></td>
          <td>–ª–≤.<%= p.price.toFixed(2) %></td>
          <td><%= p.stock %></td>
          <td><%= p.category %></td>
          <td>
            <form method="POST" action="/admin/product/update/<%= p.id %>">
              <input type="text" name="name" value="<%= p.name %>" required />
              <input type="number" name="price" value="<%= p.price %>" step="0.01" required />
              <input type="number" name="stock" value="<%= p.stock %>" required />
              <input type="text" name="category" value="<%= p.category %>" />
              <button type="submit">üíæ –ó–∞–ø–∞–∑–∏</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </table>

    <h3>‚ûï –î–æ–±–∞–≤–∏ –Ω–æ–≤ –ø—Ä–æ–¥—É–∫—Ç</h3>
    <form method="POST" action="/admin/product/create">
      <input type="text" name="name" placeholder="–ò–º–µ" required />
      <input type="text" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" />
      <input type="number" name="price" placeholder="–¶–µ–Ω–∞" step="0.01" required />
      <input type="number" name="stock" placeholder="–ù–∞–ª–∏—á–Ω–æ—Å—Ç" required />
      <input type="text" name="category" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" />
      <input type="text" name="image" placeholder="URL –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" />
      <label><input type="checkbox" name="featured" /> Featured</label>
      <button type="submit">‚úÖ –°—ä–∑–¥–∞–π</button>
    </form>
  </section>

  <section>
    <h2>üìú –ü–æ—Å–ª–µ–¥–Ω–∏ –ø–æ—Ä—ä—á–∫–∏</h2>
    <table>
      <tr><th>ID</th><th>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</th><th>–ü—Ä–æ–¥—É–∫—Ç</th><th>–°—É–º–∞</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–∞—Ç–∞</th></tr>
      <% orders.forEach(o => { %>
        <tr>
          <td><%= o.id %></td>
          <td><%= o.username %></td>
          <td><%= o.product_name %></td>
          <td>$<%= o.total_amount.toFixed(2) %></td>
          <td><%= o.payment_status %></td>
          <td><%= o.created_at %></td>
        </tr>
      <% }) %>
    </table>
  </section>
<section>
  <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
  <div style="width: 100%; max-width: 800px;">
    <canvas id="ordersChart"></canvas>
    <canvas id="revenueChart" style="margin-top: 2rem;"></canvas>
  </div>
</section>
<script>
  const ordersData = <%- JSON.stringify(chartData.ordersByDay) %>;
  const revenueData = <%- JSON.stringify(chartData.revenueByDay) %>;

  const ordersCtx = document.getElementById('ordersChart').getContext('2d');
  new Chart(ordersCtx, {
    type: 'bar',
    data: {
      labels: ordersData.map(d => d.date),
      datasets: [{
        label: 'üì¶ –ü–æ—Ä—ä—á–∫–∏',
        data: ordersData.map(d => d.count),
        backgroundColor: '#00ff00'
      }]
    }
  });

  const revenueCtx = document.getElementById('revenueChart').getContext('2d');
  new Chart(revenueCtx, {
    type: 'line',
    data: {
      labels: revenueData.map(d => d.date),
      datasets: [{
        label: 'üí∞ –ü—Ä–∏—Ö–æ–¥–∏ (–ª–≤)',
        data: revenueData.map(d => d.total),
        borderColor: '#ff0000',
        fill: false
      }]
    }
  });
</script>
</body>
</html>
